# 交互式筛选器重构与UI升级计划

根据您的需求，我将对筛选器区域进行深度改造。核心目标是**增强筛选逻辑的关联性**，并**提升UI的空间利用率和美观度**。

## 1. 筛选维度调整 (Configuration)
我们将调整 `getDrillDownDimensions` 的配置：
- ➖ **移除**: 客户类别 (`customer_category_3`)
- ➕ **新增**: 险别组合 (`coverage_type`)
- ➕ **新增**: 是否过户 (`is_transferred_vehicle`)
- 🔄 **原有保持**: 三级机构, 业务类型, 是否新能源, 续保状态, 终端来源

## 2. 动态联动逻辑 (Conditional Logic)
当用户在“业务类型”筛选器中选择了特定值时，将**动态显示**额外的评分筛选器。

| 触发条件 (业务类型包含...) | 动态显示的筛选器 | 对应字段 |
| :--- | :--- | :--- |
| `非营客-旧` | 车险分等级 | `vehicle_insurance_grade` |
| `非营货` 或 `营货-<2t` | 小货车评分 | `small_truck_score` |
| `营货` (且不含 `营货-<2t`) | 大货车评分 | `large_truck_score` |

*注：如果用户取消勾选触发条件，对应的动态筛选器将自动隐藏并清空其已选值。*

## 3. UI 交互设计草图 (UI Sketch)

### A. 整体布局 (Compact Bar)
我们将移除底部的“已选条件”标签区，将所有状态收纳进按钮本身。顶部的年度/周次输入框将进一步紧凑化。

```text
[ 📅 2025 ▼ ] [ 🗓 1-52 ]  |  [ 🏢 三级机构: 成都 (+2) ▼ ] [ 🚗 业务类型: 非营客-旧... ▼ ] [ ⚡ 新能源: 全部 ▼ ] [ ⚙️ 更多... ]
                                                                       (动态出现) ⤴
```

### B. 按钮状态样式 (Button States)
按钮文案将根据选择状态动态变化，兼顾“好看与完整”：

*   **未选择 (默认)**:
    `[ 业务类型 ▼ ]` (灰色文字)
*   **单选**:
    `[ 业务类型: 非营客-旧 ▼ ]` (高亮边框 + 红色文字)
*   **多选 (2项)**:
    `[ 业务类型: 非营客-旧 (+1) ▼ ]` (显示第一个值，右侧角标显示剩余数量)
*   **全选**:
    `[ 业务类型: 全部 ▼ ]` (或重置为默认状态)

### C. 下拉面板交互 (Dropdown Panel)
增加“反选”功能，优化操作栏。

```text
+----------------------------------+
| 🔍 搜索...                        |
+----------------------------------+
| [全选] [反选] [清空]      [确定] |  <-- 按钮区紧凑排列
+----------------------------------+
| [x] 非营客-旧                    |
| [ ] 非营客-新                    |
| [x] 营运货车                     |
| ...                              |
+----------------------------------+
```

## 4. 技术实现细节
1.  **CSS 优化**:
    *   缩减 `.filter-input` 宽度 (60px -> 45px)。
    *   重写 `.drill-selector-btn` 样式，支持内部文本截断 (`text-overflow: ellipsis`) 和 动态 Badge 布局。
    *   移除 `.drill-tags-section` 相关 DOM 和样式。
2.  **JS 逻辑增强**:
    *   监听 `ui_short_label` (业务类型) 的 `draft` 或 `applied` 状态变化。
    *   实现 `updateDynamicSelectors()` 函数，根据当前业务类型的值列表计算是否显示额外筛选器。
    *   实现 `getButtonLabel(dimension)` 函数，生成 "Value (+N)" 格式的文本。
    *   添加 `invertSelection()` 反选逻辑。

请确认以上设计方案是否符合您的预期？确认后我将开始编码。