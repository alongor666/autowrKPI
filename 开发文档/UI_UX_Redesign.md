# UI/UX 重构设计与规范文档 (UI/UX Redesign & Specifications)

> **文档版本**: 2.0
> **最后更新**: 2025-12-19
> **状态**: 已实施 (Implemented)
> **来源**: 提炼自 `D003`, `下钻UI重构`, `筛选器重构` 及现有代码库。

## 1. 核心设计原则 (Core Design Principles)

*   **文档即代码 (Documentation as Code)**: 本文档作为 UI/UX 逻辑的单一事实来源 (SSOT)。
*   **关联优先 (Association First)**: 筛选器与图表按业务逻辑分组，而非技术实现分组。
*   **电商式交互 (E-commerce Style)**: 采用紧凑的下拉选择器、标签式管理、即时反馈。
*   **统一视觉语言 (Unified Visual Language)**: 统一配色（麦肯锡风）、统一单位（元/万元）、统一预警语义。

---

## 2. 分析模式矩阵 (Analysis Mode Matrix)

引入 2x2 分析模式切换，位于筛选栏上方，控制全局数据聚合与筛选行为。

| 模式维度 | 选项 A (默认) | 选项 B | 交互行为差异 |
| :--- | :--- | :--- | :--- |
| **组织模式**<br>(Org Mode) | **多机构**<br>(Multi) | **单机构**<br>(Single) | **多机构**: 允许选择多个三级机构，图表展示机构间对比/排名。<br>**单机构**: 三级机构筛选器强制**单选**，图表聚焦单一机构详情。 |
| **区间模式**<br>(Interval Mode) | **单周**<br>(Single) | **多周**<br>(Multi) | **单周**: 年份与周次筛选器强制**单选**，聚焦特定时间切片。<br>**多周**: 允许选择多个时间点，进行趋势或累计分析。 |

---

## 3. 筛选器架构 (Filter Architecture)

所有筛选维度（含时间）统一使用 **Drill Selector** 组件。

### 3.1 分组与排序 (Grouping & Sorting)

| 分组 (Group) | 包含维度 (Dimensions) | 排序逻辑 |
| :--- | :--- | :--- |
| **1. 核心组织** | **三级机构** (`third_level_organization`) | 固定置顶 (Rank 1) |
| **2. 时间维度** | **保单年度** (`policy_start_year`)<br>**周次** (`week_number`) | 固定置顶 (Rank 2) |
| **3. 业务核心** | **险种** (`insurance_type`) *(New)*<br>**业务类型** (`ui_short_label`)<br>**险别组合** (`coverage_type`) | 动态排序：已选 > 未选 |
| **4. 车辆属性** | **是否新能源** (`is_new_energy_vehicle`)<br>**是否过户** (`is_transferred_vehicle`)<br>**续保状态** (`renewal_status`)<br>**车险分等级** (`vehicle_insurance_grade`)<br>**小/大货车评分** (`*_truck_score`) | 动态排序：已选 > 未选 |
| **5. 渠道** | **终端来源** (`terminal_source`) | 动态排序：已选 > 未选 |

### 3.2 特殊逻辑与级联 (Logic & Cascading)

1.  **级联锁定 (Cascading Locks)**:
    *   **业务类型 = "非营客-新"** $\rightarrow$ **续保状态** 锁定为 **"新保"**。
    *   **业务类型 = "非营客-旧"** $\rightarrow$ **续保状态** 排除/隐藏 **"新保"** 选项。
    *   **业务类型 = "非营客-过户"** $\rightarrow$ **是否过户** 锁定为 **"过户"**。

2.  **布尔值映射 (Boolean Mapping)**:
    *   `is_new_energy_vehicle`: `1/true` $\rightarrow$ **新能源**; `0/false` $\rightarrow$ **燃油**
    *   `is_transferred_vehicle`: `1/true` $\rightarrow$ **过户**; `0/false` $\rightarrow$ **非过户**

3.  **特殊排序**:
    *   **终端来源**: **"0110融合销售"** 始终固定在下拉列表首位。

4.  **摩托车模式 (Motorcycle Mode)**:
    *   独立于上述筛选器，位于损失分析板块。
    *   选项: **全部业务** (默认), **不含摩托车**, **仅摩托车**。
    *   影响: 全局数据过滤及预警线阈值。

---

## 4. 图表与可视化规范 (Chart & Visualization)

### 4.1 气泡图 (Bubble Chart)
*   **标签 (Label)**:
    *   格式: `名称 \n 率值%` (保留1位小数)。
    *   颜色: 统一为 **黑色 (#000000)**，确保可读性。
    *   优先级: 危险状态 > 警告状态 > 良好状态 (防止重叠时遮挡关键信息)。
*   **损失暴露分析**:
    *   **X轴**: 已报告赔款占比 (%)。
    *   **Y轴**: 满期赔付率 (%)。
    *   **气泡大小**: 已报告赔款绝对值 (元)。
    *   **排序**: 按 **赔款占比** 降序排列。

### 4.2 预警系统 (Warning System)
*   **语义**: 统一使用 **"预警线"** (Warning Line)，废弃 "危险线"。
*   **样式**: 黄色虚线 (`#ffc000`, dashed, width 2)。
*   **动态阈值 (摩托车模式联动)**:
    *   **含/仅摩托车**: 频度 **12%**, 案均 **4900元**。
    *   **不含摩托车**: 频度 **15%**, 案均 **4500元**。

### 4.3 KPI 状态阈值 (KPI Thresholds)
| 指标 | 危险 (Red) | 警告 (Yellow) | 良好 (Green) |
| :--- | :--- | :--- | :--- |
| **变动成本率** | > 94% | 91% - 94% | < 91% |
| **满期赔付率** | > 75% | 70% - 75% | < 70% |
| **费用率** | > 17% | 14% - 17% | < 14% |
| **进度达成率** | < 95% | 95% - 100% | ≥ 100% |

### 4.4 单位规范 (Unit Standardization)
*   **金额 (大)**: **万元** (如: 签单保费, 边际贡献)。
*   **金额 (小)**: **元** (如: 案均赔款)。
*   **率值**: **%** (保留 1-2 位小数)。

---

## 5. 交互细节 (Interaction Details)
*   **应用机制**: 移除全局“应用”按钮，下拉框内部点击“确定”即生效，或点击“重置”恢复默认。
*   **单/多选切换**: 根据 2x2 模式自动切换筛选器的 `type` (Radio/Checkbox)，并自动处理已有选项的冲突（如切换到单选时只保留最近一项）。
*   **全量显示**: 所有预设的 13 个筛选维度始终可见，不再根据业务类型隐藏评分项。
