# æ–°é¡¹ç›®è¿ç§»æ¸…å•

## ç›®æ ‡
åˆ›å»º autowrKPI-v2 é¡¹ç›®ï¼Œç¡®ä¿ï¼š
- âœ… åŠŸèƒ½ 100% å¤åˆ»ï¼ˆæ‰€æœ‰å›¾è¡¨ã€ç­›é€‰ã€åˆ†æåŠŸèƒ½ï¼‰
- âœ… æ·˜æ±°è¿‡æ—¶æŠ€æœ¯ï¼ˆå·¨å‹å¯¹è±¡ã€æ··ä¹±ä»£ç ï¼‰
- âœ… éµå¾ª CLAUDE.md è§„èŒƒï¼ˆä¸‰å¤§ç´¢å¼•ã€ä¸¤æœ¬è´¦ï¼‰
- âœ… åªè¿ç§»å¿…è¦å†…å®¹ï¼ˆæ’é™¤å†—ä½™ï¼‰

---

## ä¸€ã€å¿…é¡»è¿ç§»çš„å†…å®¹ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

### 1.1 ä¸šåŠ¡é…ç½®æ–‡ä»¶ï¼ˆ100% è¿ç§»ï¼‰
| æ–‡ä»¶ | ç”¨é€” | è¿ç§»ç­–ç•¥ |
|------|------|---------|
| `reference/business_type_mapping.json` | ä¸šåŠ¡ç±»å‹æ˜ å°„ | âœ… ç›´æ¥å¤åˆ¶ |
| `reference/thresholds.json` | KPI é˜ˆå€¼é…ç½® | âœ… ç›´æ¥å¤åˆ¶ |
| `reference/year-plans.json` | å¹´åº¦è®¡åˆ’æ•°æ® | âœ… ç›´æ¥å¤åˆ¶ |

**è¿ç§»å‘½ä»¤**ï¼š
```bash
cp -r autowrKPI/reference/ autowrKPI-v2/reference/
```

### 1.2 æ•°æ®å¤„ç†é€»è¾‘ï¼ˆé‡æ„åè¿ç§»ï¼‰
| æ¨¡å— | æ—§é¡¹ç›®ä½ç½® | æ–°é¡¹ç›®ä½ç½® | è¿ç§»æ–¹å¼ |
|------|-----------|-----------|---------|
| CSV è§£æ | `data.worker.js` (L62-140) | `src/workers/data.worker.ts` | ğŸ”„ é‡å†™ï¼ˆTypeScriptï¼‰ |
| æ•°æ®èšåˆ | `data.worker.js` (L200-800) | `src/services/DataService.ts` | ğŸ”„ é‡å†™ï¼ˆçº¯å‡½æ•°ï¼‰ |
| ç­›é€‰é€»è¾‘ | `data.worker.js` (L900-1200) | `src/services/FilterService.ts` | ğŸ”„ é‡å†™ï¼ˆä¼˜åŒ–ç®—æ³•ï¼‰ |

**å…³é”®å‡½æ•°æ¸…å•**ï¼š
```javascript
// å¿…é¡»è¿ç§»çš„å‡½æ•°ï¼ˆåŠŸèƒ½æ ¸å¿ƒï¼‰
- parseCSV()
- parseExcel()
- processData()
- applyFiltersAndRecalc()
- getDimensionValues()
- aggregateByDimension()
- calculateKPIs()
```

### 1.3 å›¾è¡¨æ¸²æŸ“é€»è¾‘ï¼ˆæ ¸å¿ƒä¸šåŠ¡ï¼‰
| å›¾è¡¨ç±»å‹ | æ—§é¡¹ç›®æ–¹æ³• | æ–°é¡¹ç›®ä½ç½® | è¿ç§»çŠ¶æ€ |
|---------|-----------|-----------|---------|
| ç»è¥æ¦‚è§ˆï¼ˆKPIå¡ç‰‡ï¼‰ | `dashboard.js:renderOverview()` | `src/components/MetricCard/` | ğŸ”„ é‡å†™ |
| ç»è¥æ¦‚è§ˆï¼ˆå †ç§¯å›¾ï¼‰ | `dashboard.js:renderOverviewChart()` | `src/services/ChartService.ts` | ğŸ”„ é‡å†™ |
| ä¿è´¹è¿›åº¦å›¾ | `dashboard.js:renderPremiumChart()` | `src/services/ChartService.ts` | ğŸ”„ é‡å†™ |
| å˜åŠ¨æˆæœ¬å›¾ | `dashboard.js:renderCostChart()` | `src/services/ChartService.ts` | ğŸ”„ é‡å†™ |
| æŸå¤±æš´éœ²ï¼ˆæ°”æ³¡å›¾ï¼‰ | `dashboard.js:renderLossChart()` | `src/services/ChartService.ts` | ğŸ”„ é‡å†™ |
| æŸå¤±æš´éœ²ï¼ˆè±¡é™å›¾ï¼‰ | `dashboard.js:renderQuadrantChart()` | `src/services/ChartService.ts` | ğŸ”„ é‡å†™ |
| è´¹ç”¨æ”¯å‡ºå›¾ | `dashboard.js:renderExpenseChart()` | `src/services/ChartService.ts` | ğŸ”„ é‡å†™ |
| æŠ•äº§æ•ˆç‡å›¾ | `dashboard.js:renderROIChart()` | `src/services/ChartService.ts` | ğŸ”„ é‡å†™ |

**å›¾è¡¨é…ç½®æå–**ï¼š
```javascript
// ä» dashboard.js æå– echarts é…ç½®é€»è¾‘
// é‡æ„ä¸ºçº¯å‡½æ•°ï¼ˆè¾“å…¥ï¼šæ•°æ® + ç»´åº¦ï¼Œè¾“å‡ºï¼šé…ç½®å¯¹è±¡ï¼‰
function getOverviewChartConfig(data: AggregatedData, dimension: Dimension): EChartsOption {
    // ...
}
```

### 1.4 ç­›é€‰å™¨åŠŸèƒ½ï¼ˆå®Œæ•´è¿ç§»ï¼‰
| ç­›é€‰ç»´åº¦ | æ—§é¡¹ç›®ä½ç½® | æ–°é¡¹ç›®ä½ç½® | è¿ç§»æ–¹å¼ |
|---------|-----------|-----------|---------|
| ä¸‰çº§æœºæ„ | `dashboard.js` | `src/components/FilterPanel/` | ğŸ”„ é‡å†™ï¼ˆç»„ä»¶åŒ–ï¼‰ |
| ä¿å•å¹´åº¦ | `dashboard.js` | `src/components/FilterPanel/` | ğŸ”„ é‡å†™ |
| å‘¨æ¬¡èŒƒå›´ | `dashboard.js` | `src/components/FilterPanel/` | ğŸ”„ é‡å†™ |
| ä¸šåŠ¡ç±»å‹ | `dashboard.js` | `src/components/FilterPanel/` | ğŸ”„ é‡å†™ |
| å®¢æˆ·ç±»åˆ« | `dashboard.js` | `src/components/FilterPanel/` | ğŸ”„ é‡å†™ |
| ... å…¶ä»– 8 ä¸ªç»´åº¦ | `dashboard.js` | `src/components/FilterPanel/` | ğŸ”„ é‡å†™ |

**ç­›é€‰å™¨çŠ¶æ€ç®¡ç†**ï¼š
```typescript
// æ–°é¡¹ç›®ç»Ÿä¸€çŠ¶æ€ç®¡ç†
interface FilterState {
    time: {
        year: number | null;
        weekStart: number;
        weekEnd: number;
    };
    drill: {
        applied: DrillFilter[];
        draft: Record<string, string[]>;
    };
}
```

### 1.5 UI æ ·å¼ï¼ˆé€‰æ‹©æ€§è¿ç§»ï¼‰
| æ ·å¼æ¨¡å— | æ—§é¡¹ç›® | æ–°é¡¹ç›® | è¿ç§»æ–¹å¼ |
|---------|-------|-------|---------|
| CSS å˜é‡ç³»ç»Ÿ | `dashboard.css` (L56-103) | `src/styles/variables.css` | âœ… ç›´æ¥å¤åˆ¶ |
| KPI å¡ç‰‡æ ·å¼ | `dashboard.css` (L528-543) | `src/components/MetricCard/MetricCard.css` | âœ… ç›´æ¥å¤åˆ¶ |
| ç­›é€‰å™¨æ ·å¼ | `dashboard.css` (L875-948) | `src/components/FilterPanel/FilterPanel.css` | âœ… ç›´æ¥å¤åˆ¶ |
| å›¾è¡¨å®¹å™¨æ ·å¼ | `dashboard.css` (L640-680) | `src/styles/chart.css` | âœ… ç›´æ¥å¤åˆ¶ |
| å“åº”å¼å¸ƒå±€ | `dashboard.css` (L814-849) | `src/styles/responsive.css` | âœ… ç›´æ¥å¤åˆ¶ |

---

## äºŒã€éœ€è¦æ·˜æ±°çš„å†…å®¹ï¼ˆè¿‡æ—¶æŠ€æœ¯ï¼‰

### 2.1 æ¶æ„å±‚é¢
| è¿‡æ—¶æŠ€æœ¯ | é—®é¢˜ | æ–°æŠ€æœ¯æ›¿ä»£ |
|---------|------|----------|
| âŒ å·¨å‹å¯¹è±¡ `Dashboard` | 3967 è¡Œï¼ŒèŒè´£è¿‡å¤š | âœ… ç»„ä»¶åŒ–æ¶æ„ + çŠ¶æ€ç®¡ç† |
| âŒ å…¨å±€å˜é‡æ±¡æŸ“ | `window.Dashboard` | âœ… ES6 æ¨¡å—åŒ– |
| âŒ æ··ä¹±çš„çŠ¶æ€ç®¡ç† | çŠ¶æ€æ•£è½å„å¤„ | âœ… é›†ä¸­å¼çŠ¶æ€ç®¡ç†ï¼ˆStateManagerï¼‰ |
| âŒ å›è°ƒåœ°ç‹± | åµŒå¥—å›è°ƒ | âœ… async/await |
| âŒ å†…è”äº‹ä»¶å¤„ç† | `onclick="Dashboard.xxx()"` | âœ… äº‹ä»¶å§”æ‰˜ + EventBus |

### 2.2 ä»£ç å±‚é¢
| è¿‡æ—¶ä»£ç  | ä½ç½® | åŸå›  | åˆ é™¤å†³ç­– |
|---------|------|------|---------|
| âŒ `static-report-generator.js` | 233 è¡Œ | å·²è¢« WorkerService æ›¿ä»£ | âœ… åˆ é™¤ |
| âŒ `dashboard.js` ä¸­çš„ Worker æ¡¥æ¥ | L89-120 | æ¶æ„æ··ä¹±ï¼Œç›´æ¥ç”¨ WorkerService | âœ… åˆ é™¤ |
| âŒ å†…è”æ ·å¼ | `index.html` L9-88 | åº”è¯¥åœ¨ CSS æ–‡ä»¶ä¸­ | âœ… åˆ é™¤ |
| âŒ é˜²æŠ–å‡½æ•°é‡å¤å®ç° | `dashboard.js` L2100 | åº”è¯¥ç”¨å·¥å…·åº“ | âœ… åˆ é™¤ |
| âŒ æ‰‹åŠ¨ DOM æ“ä½œ | `dashboard.js` å„å¤„ | åº”è¯¥ç”¨ç»„ä»¶å°è£… | âœ… é‡æ„ |

### 2.3 æ ·å¼å±‚é¢
| è¿‡æ—¶æ ·å¼ | ä½ç½® | é—®é¢˜ | åˆ é™¤å†³ç­– |
|---------|------|------|---------|
| âŒ é‡å¤çš„ CSS è§„åˆ™ | `dashboard.css` å¤šå¤„ | å¯ä»¥åˆå¹¶ | âœ… åˆå¹¶ |
| âŒ é­”æ³•æ•°å­— | ç¡¬ç¼–ç çš„åƒç´ å€¼ | åº”è¯¥ç”¨ CSS å˜é‡ | âœ… é‡æ„ |
| âŒ è¿‡åº¦åµŒå¥—çš„é€‰æ‹©å™¨ | è¶…è¿‡ 3 å±‚ | é™ä½æ€§èƒ½ | âœ… æ‰å¹³åŒ– |

---

## ä¸‰ã€CLAUDE.md è§„èŒƒåœ¨æ–°é¡¹ç›®ä¸­çš„åº”ç”¨

### 3.1 å¤åˆ¶å¹¶è°ƒæ•´ CLAUDE.md
```bash
# å¤åˆ¶ CLAUDE.md åˆ°æ–°é¡¹ç›®
cp autowrKPI/CLAUDE.md autowrKPI-v2/CLAUDE.md

# è°ƒæ•´å†…å®¹ï¼š
# - æ›´æ–°ä¸‰å¤§ç´¢å¼•è·¯å¾„ï¼ˆé€‚é…æ–°ç›®å½•ç»“æ„ï¼‰
# - æ›´æ–°ä¸¤æœ¬è´¦è·¯å¾„
# - æ·»åŠ æ–°çš„æŠ¤æ è§„åˆ™ï¼ˆTypeScript ç±»å‹å®šä¹‰ä¸å¾—éšæ„ä¿®æ”¹ï¼‰
```

### 3.2 æ–°é¡¹ç›®çš„ä¸‰å¤§ç´¢å¼•

#### DOC_INDEX.md
```markdown
# DOC_INDEX

## å”¯ä¸€äº‹å®æ¥æºï¼ˆæƒå¨ï¼‰
- ä¸šåŠ¡æ˜ å°„ï¼š/reference/business_type_mapping.json
- KPI é˜ˆå€¼ï¼š/reference/thresholds.json
- å¹´åº¦è®¡åˆ’ï¼š/reference/year-plans.json
- ç±»å‹å®šä¹‰ï¼š/src/types/*.types.ts  # æ–°å¢ï¼šTypeScript ç±»å‹
- å…¨å±€è®¾è®¡è§„èŒƒï¼š/docs/design-system.md

## éœ€æ±‚ä¸å†³ç­–
- éœ€æ±‚å®šä¹‰ï¼š/docs/requirements/
- å†³ç­–è®°å½•ï¼š/docs/decisions/

## å®ç°è¯´æ˜ä¸æ‰‹å†Œ
- æ¶æ„æ–‡æ¡£ï¼š/docs/architecture.md
- ç»„ä»¶æ–‡æ¡£ï¼š/docs/components/
- API æ–‡æ¡£ï¼š/docs/api/
```

#### CODE_INDEX.md
```markdown
# CODE_INDEX

## å…¥å£ä¸è¿è¡Œ
- åº”ç”¨å…¥å£ï¼š/index.html
- ä¸»æµç¨‹æ§åˆ¶ï¼š/src/main.ts  # TypeScript

## æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- åº”ç”¨åè°ƒå™¨ï¼š/src/core/App.ts
- çŠ¶æ€ç®¡ç†ï¼š/src/core/StateManager.ts
- äº‹ä»¶æ€»çº¿ï¼š/src/core/EventBus.ts

## æ•°æ®å¤„ç†
- Worker æ•°æ®å¤„ç†ï¼š/src/workers/data.worker.ts
- æ•°æ®æœåŠ¡ï¼š/src/services/DataService.ts
- ç­›é€‰æœåŠ¡ï¼š/src/services/FilterService.ts

## UI ç»„ä»¶
- ç»„ä»¶ç›®å½•ï¼š/src/components/
- æ ·å¼ç›®å½•ï¼š/src/styles/

## å·¥å…·ä¸å¸¸é‡
- æ ¼å¼åŒ–å·¥å…·ï¼š/src/utils/formatters.ts
- å¸¸é‡å®šä¹‰ï¼š/src/utils/constants.ts
- ç±»å‹å®šä¹‰ï¼š/src/types/
```

#### PROGRESS_INDEX.md
```markdown
# PROGRESS_INDEX

## å½“å‰çŠ¶æ€
- é¡¹ç›®é˜¶æ®µï¼šåˆå§‹åŒ–é˜¶æ®µ
- å®Œæˆåº¦ï¼š5%

## è¿ç§»è¿›åº¦
- [ ] Phase 1: é¡¹ç›®åˆå§‹åŒ–
- [ ] Phase 2: æ•°æ®å¤„ç†å±‚è¿ç§»
- [ ] Phase 3: å›¾è¡¨æ¸²æŸ“å±‚è¿ç§»
- [ ] Phase 4: ç­›é€‰å™¨åŠŸèƒ½è¿ç§»
- [ ] Phase 5: æµ‹è¯•ä¸ä¼˜åŒ–
```

### 3.3 ä¸¤æœ¬è´¦

#### BACKLOG.md
```markdown
# BACKLOG

## åŠŸèƒ½è¿ç§»æ¸…å•
- [ ] #1 æ•°æ®è§£æåŠŸèƒ½ï¼ˆCSV/Excelï¼‰
- [ ] #2 æ•°æ®èšåˆä¸ KPI è®¡ç®—
- [ ] #3 ç»è¥æ¦‚è§ˆå›¾è¡¨
- [ ] #4 ä¿è´¹è¿›åº¦å›¾è¡¨
- [ ] #5 å˜åŠ¨æˆæœ¬å›¾è¡¨
- [ ] #6 æŸå¤±æš´éœ²å›¾è¡¨
- [ ] #7 è´¹ç”¨æ”¯å‡ºå›¾è¡¨
- [ ] #8 ç­›é€‰å™¨ï¼ˆ13 ä¸ªç»´åº¦ï¼‰
- [ ] #9 å“åº”å¼å¸ƒå±€
- [ ] #10 æ€§èƒ½ä¼˜åŒ–
```

#### PROGRESS.md
```markdown
# PROGRESS

## 2025-XX-XXï¼ˆç¤ºä¾‹ï¼‰

### âœ… DONE
- åˆ›å»ºé¡¹ç›®éª¨æ¶
- åˆå§‹åŒ– TypeScript + Vite
- å¤åˆ¶ reference/ ä¸šåŠ¡é…ç½®

### ğŸš§ DOING
- å®ç°æ•°æ®å¤„ç†å±‚

### ğŸ“ TODO
- å›¾è¡¨æ¸²æŸ“å±‚
- ç­›é€‰å™¨ç»„ä»¶
```

---

## å››ã€è¿ç§»æ­¥éª¤ï¼ˆåˆ†é˜¶æ®µæ‰§è¡Œï¼‰

### Phase 1: é¡¹ç›®åˆå§‹åŒ–ï¼ˆç¬¬ 1 å‘¨ï¼‰
**ç›®æ ‡**ï¼šæ­å»ºé¡¹ç›®éª¨æ¶ï¼Œç¡®ä¿åŸºç¡€è®¾æ–½å°±ç»ª

#### 1.1 åˆ›å»ºé¡¹ç›®ç›®å½•
```bash
cd /Users/xuechenglong/Downloads
mkdir autowrKPI-v2
cd autowrKPI-v2
```

#### 1.2 åˆå§‹åŒ– package.json
```json
{
  "name": "autowrkpi-v2",
  "version": "2.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "test": "vitest",
    "lint": "eslint src --ext ts,tsx"
  },
  "dependencies": {
    "echarts": "^5.5.0"
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "typescript": "^5.3.0",
    "vite": "^5.0.0",
    "vitest": "^1.0.0",
    "eslint": "^8.55.0",
    "@typescript-eslint/parser": "^6.15.0",
    "@typescript-eslint/eslint-plugin": "^6.15.0"
  }
}
```

#### 1.3 åˆ›å»º tsconfig.json
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "moduleResolution": "bundler",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "outDir": "dist",
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"]
}
```

#### 1.4 åˆ›å»ºç›®å½•ç»“æ„
```bash
mkdir -p src/{core,components,services,workers,utils,types,styles}
mkdir -p public/assets
mkdir -p tests/{unit,integration,e2e}
mkdir -p docs/{requirements,decisions,components}
mkdir -p reference
```

#### 1.5 å¤åˆ¶ä¸šåŠ¡é…ç½®
```bash
cp -r ../autowrKPI/reference/* ./reference/
```

#### 1.6 å¤åˆ¶å¹¶è°ƒæ•´ CLAUDE.md
```bash
cp ../autowrKPI/CLAUDE.md ./CLAUDE.md
# æ‰‹åŠ¨è°ƒæ•´ç´¢å¼•è·¯å¾„
```

#### 1.7 åˆ›å»ºä¸‰å¤§ç´¢å¼•
```bash
mkdir -p docs/00_index
touch docs/00_index/DOC_INDEX.md
touch docs/00_index/CODE_INDEX.md
touch docs/00_index/PROGRESS_INDEX.md
```

#### 1.8 åˆ›å»ºä¸¤æœ¬è´¦
```bash
touch BACKLOG.md
touch PROGRESS.md
```

### Phase 2: æ•°æ®å¤„ç†å±‚è¿ç§»ï¼ˆç¬¬ 2-3 å‘¨ï¼‰
**ç›®æ ‡**ï¼šé‡å†™æ•°æ®å¤„ç†é€»è¾‘ï¼Œç¡®ä¿åŠŸèƒ½ä¸æ—§é¡¹ç›®ä¸€è‡´

#### 2.1 ç±»å‹å®šä¹‰
```typescript
// src/types/data.types.ts
export interface RawDataRow {
    ä¿å•å·: string;
    ä¸‰çº§æœºæ„: string;
    ä¿å•å¹´åº¦: number;
    å‘¨æ¬¡: number;
    ä¸šåŠ¡ç±»å‹: string;
    // ... å…¶ä»–å­—æ®µ
}

export interface AggregatedData {
    summary: KPISummary;
    byOrg: Record<string, MetricGroup>;
    byCategory: Record<string, MetricGroup>;
    byBusinessType: Record<string, MetricGroup>;
}

export interface KPISummary {
    ç­¾å•ä¿è´¹: number;
    å˜åŠ¨æˆæœ¬ç‡: number;
    æ»¡æœŸèµ”ä»˜ç‡: number;
    è´¹ç”¨ç‡: number;
    ä¿è´¹æ—¶é—´è¿›åº¦è¾¾æˆç‡: number;
    // ...
}
```

#### 2.2 DataService å®ç°
```typescript
// src/services/DataService.ts
export class DataService {
    async parseFile(file: File): Promise<RawDataRow[]> {
        // é‡å†™ CSV/Excel è§£æé€»è¾‘
    }

    processData(rawData: RawDataRow[]): AggregatedData {
        // é‡å†™æ•°æ®èšåˆé€»è¾‘
    }

    applyFilters(data: RawDataRow[], filters: FilterState): RawDataRow[] {
        // é‡å†™ç­›é€‰é€»è¾‘
    }

    calculateKPIs(data: RawDataRow[]): KPISummary {
        // é‡å†™ KPI è®¡ç®—é€»è¾‘
    }
}
```

#### 2.3 å•å…ƒæµ‹è¯•
```typescript
// tests/unit/DataService.test.ts
import { describe, test, expect } from 'vitest';
import { DataService } from '@/services/DataService';

describe('DataService', () => {
    test('calculateKPIs returns correct values', () => {
        const service = new DataService();
        const mockData = [/* ... */];
        const result = service.calculateKPIs(mockData);

        expect(result.ç­¾å•ä¿è´¹).toBeCloseTo(1000000, 2);
        expect(result.å˜åŠ¨æˆæœ¬ç‡).toBeCloseTo(92.5, 1);
    });
});
```

### Phase 3: å›¾è¡¨æ¸²æŸ“å±‚è¿ç§»ï¼ˆç¬¬ 4-5 å‘¨ï¼‰
**ç›®æ ‡**ï¼šé‡å†™ 8 ä¸ªå›¾è¡¨æ¸²æŸ“å‡½æ•°

#### 3.1 ChartService éª¨æ¶
```typescript
// src/services/ChartService.ts
import type { EChartsOption } from 'echarts';
import type { AggregatedData, Dimension } from '@/types';

export class ChartService {
    private charts = new Map<string, echarts.ECharts>();

    renderOverviewChart(data: AggregatedData, dimension: Dimension): EChartsOption {
        // ä» dashboard.js è¿ç§»å¹¶é‡æ„
    }

    renderPremiumChart(data: AggregatedData, dimension: Dimension): EChartsOption {
        // ...
    }

    // ... å…¶ä»– 6 ä¸ªå›¾è¡¨æ–¹æ³•
}
```

#### 3.2 è¿ç§»ç­–ç•¥
1. ä» `dashboard.js` æå– `renderXXXChart()` æ–¹æ³•
2. é‡æ„ä¸ºçº¯å‡½æ•°ï¼ˆç§»é™¤å¯¹ `this.data` çš„ä¾èµ–ï¼‰
3. æ·»åŠ  TypeScript ç±»å‹
4. å•å…ƒæµ‹è¯•éªŒè¯
5. è§†è§‰å›å½’æµ‹è¯•ï¼ˆå¯¹æ¯”æ–°æ—§æˆªå›¾ï¼‰

### Phase 4: ç­›é€‰å™¨åŠŸèƒ½è¿ç§»ï¼ˆç¬¬ 6 å‘¨ï¼‰
**ç›®æ ‡**ï¼šå®ç° 13 ä¸ªç»´åº¦ç­›é€‰å™¨

#### 4.1 FilterPanel ç»„ä»¶
```typescript
// src/components/FilterPanel/FilterPanel.ts
import { EventBus } from '@/core/EventBus';
import { EVENTS } from '@/utils/constants';
import type { FilterState, Dimension } from '@/types';

export class FilterPanel {
    private state: FilterState;

    constructor(workerService: WorkerService) {
        // ...
    }

    async loadDimensionValues(dimension: Dimension): Promise<string[]> {
        // ...
    }

    applyFilters(): void {
        EventBus.emit(EVENTS.FILTER_CHANGED, this.state);
    }
}
```

#### 4.2 è¿ç§» 13 ä¸ªç»´åº¦
æŒ‰ç…§ `UI_UX_Redesign.md` çš„è®¾è®¡ï¼Œå®ç°ï¼š
1. ä¸‰çº§æœºæ„
2. ä¿å•å¹´åº¦
3. å‘¨æ¬¡
4. é™©ç§
5. ä¸šåŠ¡ç±»å‹
6. é™©åˆ«ç»„åˆ
7. æ–°èƒ½æº
8. æ˜¯å¦è¿‡æˆ·
9. ç»­ä¿çŠ¶æ€
10. è½¦é™©åˆ†ç­‰çº§
11. å°è´§è½¦è¯„åˆ†
12. å¤§è´§è½¦è¯„åˆ†
13. ç»ˆç«¯æ¥æº

### Phase 5: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆç¬¬ 7-8 å‘¨ï¼‰
**ç›®æ ‡**ï¼šç¡®ä¿æ–°é¡¹ç›®ç¨³å®šã€é«˜æ€§èƒ½

#### 5.1 åŠŸèƒ½å¯¹æ¯”æµ‹è¯•
- [ ] æ‰€æœ‰å›¾è¡¨æ•°æ®ä¸æ—§é¡¹ç›®ä¸€è‡´
- [ ] ç­›é€‰å™¨åŠŸèƒ½å®Œå…¨ä¸€è‡´
- [ ] KPI è®¡ç®—ç»“æœä¸€è‡´

#### 5.2 æ€§èƒ½ä¼˜åŒ–
- [ ] é¦–å±åŠ è½½ < 2s
- [ ] å›¾è¡¨æ¸²æŸ“ < 300ms
- [ ] Worker å¤„ç†å¤§æ–‡ä»¶ < 3s

#### 5.3 ä»£ç è´¨é‡
- [ ] TypeScript é›¶é”™è¯¯
- [ ] ESLint é›¶è­¦å‘Š
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%

---

## äº”ã€æ–°æ—§é¡¹ç›®å¹¶è¡Œç®¡ç†ç­–ç•¥

### 5.1 ç›®å½•ç»“æ„
```
/Users/xuechenglong/Downloads/
â”œâ”€â”€ autowrKPI/           # æ—§é¡¹ç›®ï¼ˆç¨³å®šç‰ˆæœ¬ï¼Œä»…ä¿® bugï¼‰
â”‚   â”œâ”€â”€ CLAUDE.md
â”‚   â”œâ”€â”€ reference/
â”‚   â””â”€â”€ ...
â””â”€â”€ autowrKPI-v2/        # æ–°é¡¹ç›®ï¼ˆç°ä»£åŒ–é‡æ„ï¼‰
    â”œâ”€â”€ CLAUDE.md        # è°ƒæ•´åçš„è§„èŒƒ
    â”œâ”€â”€ reference/       # å¤åˆ¶è‡ªæ—§é¡¹ç›®
    â”œâ”€â”€ src/
    â”œâ”€â”€ docs/
    â””â”€â”€ ...
```

### 5.2 Git ç®¡ç†ç­–ç•¥
```bash
# æ—§é¡¹ç›®ï¼šä¿æŒåŸæœ‰ Git ä»“åº“
cd autowrKPI
git branch stable-v1  # åˆ›å»ºç¨³å®šåˆ†æ”¯
git checkout stable-v1

# æ–°é¡¹ç›®ï¼šåˆ›å»ºç‹¬ç«‹ Git ä»“åº“
cd autowrKPI-v2
git init
git remote add origin <new-repo-url>
git commit -m "ğŸš€ Initial commit for autowrKPI v2 (TypeScript + Vite)"
```

### 5.3 å¹¶è¡Œå¼€å‘è§„åˆ™
| åœºæ™¯ | åœ¨å“ªä¸ªé¡¹ç›®ä¿®æ”¹ | åŒæ­¥ç­–ç•¥ |
|------|--------------|---------|
| ä¸šåŠ¡é…ç½®å˜æ›´ï¼ˆreference/ï¼‰ | autowrKPIï¼ˆæ—§ï¼‰ | æ‰‹åŠ¨åŒæ­¥åˆ° autowrKPI-v2 |
| Bug ä¿®å¤ | autowrKPIï¼ˆæ—§ï¼‰ | è®°å½•åˆ° autowrKPI-v2 å¾…åŠ |
| æ–°åŠŸèƒ½å¼€å‘ | autowrKPI-v2ï¼ˆæ–°ï¼‰ | ä¸å›æº¯åˆ°æ—§é¡¹ç›® |
| è®¾è®¡è§„èŒƒæ›´æ–° | autowrKPI-v2ï¼ˆæ–°ï¼‰ | ä¸å›æº¯ |

### 5.4 åˆ‡æ¢æ—¶æœº
å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œæ­£å¼åˆ‡æ¢åˆ°æ–°é¡¹ç›®ï¼š
- [x] æ‰€æœ‰åŠŸèƒ½å¯¹æ¯”æµ‹è¯•é€šè¿‡
- [x] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [x] ç”¨æˆ·éªŒæ”¶æµ‹è¯•é€šè¿‡
- [x] æ–‡æ¡£å®Œæ•´
- [x] éƒ¨ç½²æµç¨‹éªŒè¯

åˆ‡æ¢åï¼š
- autowrKPI å½’æ¡£ï¼ˆåªè¯»ï¼Œç”¨äºå‚è€ƒï¼‰
- autowrKPI-v2 é‡å‘½åä¸º autowrKPIï¼ˆæˆ–ç›´æ¥æ›¿æ¢ï¼‰

---

## å…­ã€é£é™©æ§åˆ¶æ¸…å•

### 6.1 åŠŸèƒ½ä¸¢å¤±é£é™©
**é£é™©**ï¼šè¿ç§»è¿‡ç¨‹ä¸­é—æ¼æŸäº›åŠŸèƒ½

**ç¼“è§£æªæ–½**ï¼š
- [ ] åˆ›å»ºåŠŸèƒ½æ¸…å•ï¼ˆå¯¹ç…§æ—§é¡¹ç›®é€ä¸€æ£€æŸ¥ï¼‰
- [ ] æ¯å®Œæˆä¸€ä¸ªæ¨¡å—ï¼Œç”¨æ—§æ•°æ®å¯¹æ¯”æµ‹è¯•
- [ ] ç”¨æˆ·å‚ä¸éªŒæ”¶ï¼ˆæä¾› checklistï¼‰

### 6.2 æ€§èƒ½å›é€€é£é™©
**é£é™©**ï¼šæ–°æ¶æ„åè€Œæ›´æ…¢

**ç¼“è§£æªæ–½**ï¼š
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆè®°å½•æ—§é¡¹ç›®æ€§èƒ½æ•°æ®ï¼‰
- [ ] å…³é”®è·¯å¾„æ€§èƒ½ç›‘æ§
- [ ] å¿…è¦æ—¶å›æ»šæˆ–ä¼˜åŒ–

### 6.3 ä¸šåŠ¡ç†è§£åå·®é£é™©
**é£é™©**ï¼šé‡æ„æ—¶è¯¯è§£ä¸šåŠ¡é€»è¾‘

**ç¼“è§£æªæ–½**ï¼š
- [ ] ä¿ç•™æ—§ä»£ç æ³¨é‡Šï¼ˆå¤åˆ¶åˆ°æ–°é¡¹ç›®ï¼‰
- [ ] å…³é”®é€»è¾‘æ·»åŠ è¯¦ç»†æ–‡æ¡£
- [ ] ä¸ä¸šåŠ¡ä¸“å®¶ç¡®è®¤ KPI è®¡ç®—å…¬å¼

### 6.4 æ—¶é—´å»¶æœŸé£é™©
**é£é™©**ï¼š8 å‘¨æ— æ³•å®Œæˆ

**ç¼“è§£æªæ–½**ï¼š
- [ ] MVP ä¼˜å…ˆï¼ˆå…ˆè¿ç§»æ ¸å¿ƒåŠŸèƒ½ï¼‰
- [ ] æ¯å‘¨è¿›åº¦å®¡æŸ¥
- [ ] å¿…è¦æ—¶å»¶é•¿å·¥æœŸæˆ–è°ƒæ•´èŒƒå›´

---

## ä¸ƒã€æˆåŠŸæ ‡å‡†

### 7.1 åŠŸèƒ½å®Œæ•´æ€§
- [ ] æ‰€æœ‰ 8 ä¸ªå›¾è¡¨æ­£å¸¸æ¸²æŸ“
- [ ] 13 ä¸ªç­›é€‰ç»´åº¦å…¨éƒ¨å¯ç”¨
- [ ] KPI è®¡ç®—ç»“æœä¸æ—§é¡¹ç›®ä¸€è‡´
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸

### 7.2 ä»£ç è´¨é‡
- [ ] TypeScript é›¶é”™è¯¯
- [ ] ESLint é›¶è­¦å‘Š
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] å¹³å‡å‡½æ•°è¡Œæ•° < 30
- [ ] æœ€å¤§æ–‡ä»¶è¡Œæ•° < 300

### 7.3 æ€§èƒ½æŒ‡æ ‡
- [ ] é¦–å±åŠ è½½ < 2s
- [ ] å›¾è¡¨æ¸²æŸ“ < 300ms
- [ ] ç­›é€‰å™¨å“åº” < 100ms
- [ ] Worker å¤„ç† 100MB æ–‡ä»¶ < 5s

### 7.4 å¯ç»´æŠ¤æ€§
- [ ] æ–°å¢å›¾è¡¨ < 2 å°æ—¶
- [ ] æ–°å¢ç­›é€‰ç»´åº¦ < 1 å°æ—¶
- [ ] Bug å®šä½ < 15 åˆ†é’Ÿ
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡ç‡ > 95%

---

## å…«ã€é™„å½•

### 8.1 æ—§é¡¹ç›®åŠŸèƒ½æ¸…å•ï¼ˆå¯¹ç…§æ£€æŸ¥ç”¨ï¼‰
- [ ] ç»è¥æ¦‚è§ˆ - KPI å¡ç‰‡ï¼ˆ8 ä¸ªæŒ‡æ ‡ï¼‰
- [ ] ç»è¥æ¦‚è§ˆ - å †ç§¯å›¾ï¼ˆ3 ä¸ªç»´åº¦ï¼‰
- [ ] ä¿è´¹è¿›åº¦ - æŸ±çŠ¶å›¾ï¼ˆ3 ä¸ªç»´åº¦ï¼‰
- [ ] å˜åŠ¨æˆæœ¬ - æŸ±çŠ¶å›¾ï¼ˆ3 ä¸ªç»´åº¦ï¼‰
- [ ] æŸå¤±æš´éœ² - æ°”æ³¡å›¾ï¼ˆ3 ä¸ªç»´åº¦ï¼‰
- [ ] æŸå¤±æš´éœ² - è±¡é™å›¾ï¼ˆ3 ä¸ªç»´åº¦ï¼‰
- [ ] è´¹ç”¨æ”¯å‡º - åŒ Y è½´å›¾ï¼ˆ3 ä¸ªç»´åº¦ï¼‰
- [ ] è´¹ç”¨æ”¯å‡º - è¶…æ”¯åˆ†æå›¾
- [ ] è´¹ç”¨æ”¯å‡º - æŠ•äº§æ•ˆç‡å›¾ï¼ˆ3 ä¸ªç»´åº¦ï¼‰
- [ ] æ—¶é—´ç­›é€‰å™¨ï¼ˆå¹´åº¦ + å‘¨æ¬¡èŒƒå›´ï¼‰
- [ ] é’»å–ç­›é€‰å™¨ï¼ˆ13 ä¸ªç»´åº¦ï¼‰
- [ ] é‡ç½®ç­›é€‰å™¨
- [ ] Tab åˆ‡æ¢
- [ ] ç»´åº¦åˆ‡æ¢
- [ ] æ‚¬æµ®ä¸Šä¼ æŒ‰é’®
- [ ] é”®ç›˜å¯¼èˆª
- [ ] å“åº”å¼å¸ƒå±€

### 8.2 å‚è€ƒæ–‡æ¡£
- `UI_UX_Redesign.md` - ç­›é€‰å™¨è®¾è®¡è§„èŒƒ
- `å…¨å±€è®¾è®¡è§„èŒƒ.md` - æ ·å¼ç³»ç»Ÿ
- `ä»£ç æ¶æ„ä¼˜åŒ–æ–¹æ¡ˆ.md` - é‡æ„æ–¹æ¡ˆ

### 8.3 å·¥å…·æ¨è
- **ä»£ç è¿ç§»**ï¼šæ‰‹åŠ¨å¤åˆ¶ + é‡æ„ï¼ˆä¸æ¨èè‡ªåŠ¨å·¥å…·ï¼‰
- **æµ‹è¯•å·¥å…·**ï¼šVitestï¼ˆå•å…ƒæµ‹è¯•ï¼‰+ Playwrightï¼ˆE2Eï¼‰
- **æ€§èƒ½ç›‘æ§**ï¼šChrome DevTools + Lighthouse
- **è§†è§‰å›å½’**ï¼šPercy.io æˆ–æ‰‹åŠ¨å¯¹æ¯”æˆªå›¾
