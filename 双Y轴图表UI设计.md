# 经营概览双Y轴图表UI设计

## 📊 设计概述

将现有的单柱状图升级为双Y轴复合图表：
- **左Y轴**：变动成本率堆叠柱状图（满期赔付率 + 费用率）
- **右Y轴**：保费时间进度达成率柱状图（仅三级机构无筛选时显示）

## 🎨 UI草图设计

### 情况1：三级机构维度且无细分筛选时（显示双Y轴）

```
┌──────────────────────────────────────────────────────────────┐
│                    经营概览 - 三级机构                        │
├──────────────────────────────────────────────────────────────┤
│  100% ┤                                                      │
│       │                                                  │
│   90% ┤      ╭─╮          ╭─╮                              │
│       │    ╭─╯ │ ╰─╮      ╭─╯ │ ╰─╮                          │
│   80% ┤  ╭─╯   │   │ ╰─╮  │   │   │ ╰─╮                       │
│       │ ╭─╯     │   │   │ ╰─╯ │   │   │   │                      │
│   70% ┤│        │   │   │     │   │   │   │                     │
│       ││        │   │   │     │   │   │   │                     │
│   60% ┤│        │   │   │     │   │   │   │                     │
│       ││        │   │   │     │   │   │   │                     │
│   50% ┤│        │   │   │     │   │   │   │                     │
│       ││        │   │   │     │   │   │   │                     │
│   40% ┤│        │   │   │     │   │   │   │                     │
│       ││        │   │   │     │   │   │   │                     │
│   30% ┤│        │   │   │     │   │   │   │                     │
│       ││        │   │   │     │   │   │   │                     │
│   20% ┤│        │   │   │     │   │   │   │                     │
│       ││        │   │   │     │   │   │   │                     │
│   10% ┤│        │   │   │     │   │   │   │                     │
│       ││        │   │   │     │   │   │   │                     │
│    0% ┼──┼────────┼───┼───┼───┼───┼───┼───┼─────────────────┤
│       │  天府    武侯     高新     青羊     新都    ...       │
│       │                                                  │
│  📊 左Y轴: 成本率%    📊 右Y轴: 保费达成率%               │
│  🔵 堆叠: 满期赔付率    🔴 柱状: 保费时间进度达成率         │
│  🟢 堆叠: 费用率                                        │
└──────────────────────────────────────────────────────────────┘
```

**堆叠柱状图内部数值显示：**
```
天府
┌─────────┐
│  15.2%  │ ← 费用率（上部）
├─────────┤
│  68.5%  │ ← 满期赔付率（底部）
└─────────┘
│ 83.7%   │ ← 总变动成本率
```

### 情况2：三级机构维度但有细分筛选时（仅显示堆叠图）

```
┌──────────────────────────────────────────────────────────────┐
│                    经营概览 - 三级机构                        │
├──────────────────────────────────────────────────────────────┤
│  100% ┤                                                      │
│       │                                                  │
│   90% ┤              ╭─────╮                                │
│       │            ╭─╯     ╰─╮                              │
│   80% ┤           ╱│         │╲                             │
│       │         ╭─╯│         │ ╰─╮                          │
│   70% ┤        ╱   │         │   ╲ │                         │
│       │      ╭─╯    │         │    ╰─╮                       │
│   60% ┤     ╱       │         │      ╲ │                      │
│       │   ╭─╯        │         │       ╰─╮                    │
│   50% ┤  ╱          │         │         ╲│                   │
│       │ ╭─╮          │         │          ╰─╮                 │
│   40% ┤╱   │          │         │            │╲                │
│       │    │          │         │            │ │               │
│   30% ┤    │          │         │            │ │               │
│       │    │          │         │            │ │               │
│   20% ┤    │          │         │            │ │               │
│       │    │          │         │            │ │               │
│   10% ┤    │          │         │            │ │               │
│       │    │          │         │            │ │               │
│    0% ┼────┼──────────┼─────────┼────────────┼─────────────────┤
│       │  天府        高新        青羊        新都              │
│       │                                                  │
│  🔵 堆叠底部: 满期赔付率    🟢 堆叠上部: 费用率               │
└──────────────────────────────────────────────────────────────┘
```

### 情况3：客户类别维度（仅堆叠图，无折线）

```
┌──────────────────────────────────────────────────────────────┐
│                    经营概览 - 客户类别                        │
├──────────────────────────────────────────────────────────────┤
│  100% ┤                                                      │
│       │                                                  │
│   90% ┤    ╭─────╮                                         │
│       │  ╭─╯     ╰─╮                                       │
│   80% ┤ ╭─╯         ╰─╮                                    │
│       │╱             │╲                                   │
│   70% ┤│              │ ╲                                  │
│       ││              │  ╲                                 │
│   60% ┤│              │   ╲                                │
│       ││              │    ╲                               │
│   50% ┤│              │     ╲                              │
│       ││              │      ╲                             │
│   40% ┤│              │       ╲                            │
│       ││              │        ╲                           │
│   30% ┤│              │         ╲                          │
│       ││              │          ╲                         │
│   20% ┤│              │           ╲                        │
│       ││              │            ╲                       │
│   10% ┤│              │             ╲                      │
│       ││              │              ╲                     │
│    0% ┼┼──────────────┼────────────────┼───────────────────┤
│       │    个人        团体           经代渠道              │
│       │                                                  │
│  🔵 满期赔付率    🟢 费用率                              │
└──────────────────────────────────────────────────────────────┘
```

### 情况4：业务类型维度（仅堆叠图，无折线）

```
┌──────────────────────────────────────────────────────────────┐
│                    经营概览 - 业务类型                        │
├──────────────────────────────────────────────────────────────┤
│  100% ┤                                                      │
│       │                                                  │
│   90% ┤                                                    │
│       │                                                  │
│   80% ┤                ╭─────╮                             │
│       │              ╭─╯     ╰─╮                           │
│   70% ┤            ╭─╯         ╰─╮                        │
│       │          ╭─╯             ╰─╮                      │
│   60% ┤         ╱                   ╲                     │
│       │       ╭─╮                   ╭─╮                   │
│   50% ┤      ╱   │                   │   ╲                │
│       │    ╭─╮   │                   │   ╭─╮              │
│   40% ┤   ╱   │  │                   │  │   │╲             │
│       │ ╭─╮   │  │                   │  │   │ ╰─╮          │
│   30% ┤╱   │  │  │                   │  │   │   │ ╲        │
│       │    │  │  │                   │  │   │   │  │       │
│   20% ┤    │  │  │                   │  │   │   │  │       │
│       │    │  │  │                   │  │   │   │  │       │
│   10% ┤    │  │  │                   │  │   │   │  │       │
│       │    │  │  │                   │  │   │   │  │       │
│    0% ┼────┼──┼──┼───────────────────┼──┼───┼───┼──┼─────┤
│       │ 车险  非车险  意健险  农险    责任险  其他          │
│       │                                                  │
│  🔵 满期赔付率    🟢 费用率                              │
└──────────────────────────────────────────────────────────────┘
```

## 🎯 交互特性

### 1. 条件显示逻辑
```javascript
// 显示条件判断
function shouldShowProgressLine() {
    return currentDimension === 'org' && 
           hasNoOtherFilters(); // 没有任何细分筛选条件
}
```

**关键约束**：只有机构级别的保费计划，没有细分项的保费计划

### 2. Tooltip设计
```javascript
// 堆叠柱状图 + 柱状图组合tooltip
        tooltip: {
            trigger: 'axis',
            formatter: function(params) {
                let result = `${params[0].axisValue}<br/>`;
                
                // 变动成本率堆叠部分
                params.filter(p => p.seriesName === '满期赔付率' || p.seriesName === '费用率').forEach(item => {
                    result += `${item.marker}${item.seriesName}: ${item.value}%<br/>`;
                });
                
                // 保费进度柱状图部分（如果存在）
                params.filter(p => p.seriesName === '保费时间进度达成率').forEach(item => {
                    result += `${item.marker}保费时间进度达成率: ${item.value}%<br/>`;
                });
                
                return result;
            }
        }
```

### 3. 图例设计
- **堆叠图例**：满期赔付率（蓝色）、费用率（绿色）
- **折线图例**：保费时间进度达成率（红色，条件显示）

### 4. 数值标签设计
```javascript
// 堆叠柱状图内部标签
label: {
    show: true,
    position: 'inside',
    formatter: function(params) {
        if (params.componentSubType === 'bar') {
            return `${params.value}%`;  // 显示内部百分比
        }
    }
}
```

## 🎨 颜色方案

| 指标 | 颜色 | 十六进制 | 用途 |
|------|------|----------|------|
| 满期赔付率 | 蓝色 | #1890ff | 堆叠底部 |
| 费用率 | 绿色 | #52c41a | 堆叠上部 |
| 保费达成率 | 红色 | #ff4d4f | 折线图 |
| 预警线 | 橙色 | #faad14 | 阈值标识 |

## 📏 响应式设计

### 桌面端（>1200px）
- 图表高度：400px
- 字体大小：12px
- 图例位置：顶部水平排列

### 平板端（768px-1200px）
- 图表高度：350px
- 字体大小：11px
- 图例位置：右侧垂直排列

### 移动端（<768px）
- 图表高度：300px
- 字体大小：10px
- 图例位置：底部可滚动

## 🔧 技术实现要点

### 1. ECharts配置结构
```javascript
option = {
    tooltip: { trigger: 'axis' },
    legend: { data: ['满期赔付率', '费用率', '保费时间进度达成率'] },
    xAxis: { type: 'category', data: categories },
    yAxis: [
        {
            type: 'value',
            name: '成本率(%)',
            max: 100,
            position: 'left'
        },
        {
            type: 'value', 
            name: '达成率(%)',
            max: 100,
            position: 'right'
        }
    ],
    series: [
        {
            name: '满期赔付率',
            type: 'bar',
            stack: 'cost',
            yAxisIndex: 0,
            data: claimRates
        },
        {
            name: '费用率', 
            type: 'bar',
            stack: 'cost',
            yAxisIndex: 0,
            data: expenseRates
        },
        {
            name: '保费时间进度达成率',
            type: 'bar',
            yAxisIndex: 1,
            data: progressRates
        }
    ]
};
```

### 2. 数据处理流程
```javascript
// 数据聚合和计算
function processChartData(dimension, data) {
    // 1. 按维度分组数据
    // 2. 计算满期赔付率 = 已决赔款 / 满期保费
    // 3. 计算费用率 = 费用 / 自留保费
    // 4. 计算保费进度 = 实际保费 / 计划保费（仅机构级别）
    // 5. 判断是否显示折线图（仅机构维度且无细分筛选）
}
```

## 📋 业务逻辑说明

### 核心约束
**只有机构级别的保费计划，没有细分项的保费计划**

### 具体场景
- ✅ **显示折线图**：三级机构维度 + 无任何其他筛选条件
  - 示例：查看所有天府机构的数据
  - 示例：选择天府+高新两个机构对比
- ❌ **不显示折线图**：任何细分筛选存在
  - 示例：天府+摩托车（无天府摩托车保费计划）
  - 示例：宜宾+营业货车（无宜宾营业货车保费计划）
  - 示例：客户类别维度（无客户级别保费计划）

### 保费计划数据结构
```json
{
  "年度保费计划": {
    "四川分公司": 431000000,  // ✅ 有计划
    "天府": 197300000,        // ✅ 有计划  
    "宜宾": 22700000,         // ✅ 有计划
    // ❌ 没有"宜宾+摩托车"的计划
    // ❌ 没有"个人客户"的计划
    // ❌ 没有"摩托车业务类型"的计划
  }
}
```

这个设计方案保持了现有系统的视觉一致性，同时增强了数据展示的丰富性和交互性，并严格遵循了数据约束条件。