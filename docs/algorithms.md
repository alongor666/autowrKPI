# 指标与算法说明

## 基础聚合
- 累计签单保费 = Σ `signed_premium_yuan`
- 累计满期保费 = Σ `matured_premium_yuan`
- 累计已报告赔款 = Σ `reported_claim_payment_yuan`
- 累计费用额 = Σ `expense_amount_yuan`
- 保单件数/赔案件数 = Σ `policy_count` / Σ `claim_case_count`
- 年度计划 = Σ `premium_plan_yuan`（或外部计划覆盖）

## 核心比率（%）
- 满期赔付率 = 已报告赔款 / 满期保费 * 100
- 费用率 = 费用额 / 签单保费 * 100
- 变动成本率 = 满期赔付率 + 费用率
- 保费时间进度达成率 = (签单保费 / 年度计划) ÷ (已过天数/365) * 100（年度计划=0 时为 None）

## 金额类
- 签单保费、满期保费、已报告赔款、费用额均以“元”存储；前端显示时可换算万元。
- 满期边际贡献率 = 100 - 变动成本率
- 满期边际贡献额（元）= 满期保费 * 满期边际贡献率

## 结构类
- 出险率 = 赔案件数 / 保单件数 * 100
- 案均赔款 = 已报告赔款 / 赔案件数
- 保费占比 = 分组签单保费 / 全量签单保费 * 100
- 已报告赔款占比 = 分组已报告赔款 / 全量已报告赔款 * 100
- 年计划达成率（分组）= 签单保费 / 该分组计划 × (1/时间进度)

## 时间进度计算
- days_passed = 340 + (week-49)*7 （限制 1~365）
- time_progress = days_passed / 365

## 阈值与告警
- 问题机构：
  - 变动成本率 > `变动成本率超标`
  - 年计划达成率 < `年保费未达标`（且>0）
  - 费用率 > `费用率超标`
- 四象限基准线：满期赔付率、费用率、出险率、案均赔款、变动成本率等用于图表基准。

## 排序与截断规则
- 机构维度：剔除“本部”，按差到好排序（成本率/赔付率/费用率高在前），取前 12。
- 保费进度：有计划时按年计划达成率从低到高；无计划时按签单保费从低到高。

## 边界处理
- 分母为 0 → 返回 0 或 None（保费进度），避免异常。
- 映射缺失 → `ui_short_label` 回退为原值，类别为“未知”。
- 年份/周次缺失 → 年份从文件名提取，周次从 CSV `week_number`，否则默认 2025/49。
